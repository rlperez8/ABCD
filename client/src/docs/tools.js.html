<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: tools.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: tools.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Draws the live price label on the price-axis canvas as the mouse moves.
 *
 * This function converts the mouse's Y position into a price value
 * based on the current chart scaling and vertical offset. It then
 * renders that price as text next to the mouse cursor.
 *
 * @param {Object} candleChartRef - A React ref object containing all current chart state and geometry info.
 * @param {CanvasRenderingContext2D} ctx_price - The 2D canvas rendering context used to draw the price text.
 *
 * @description
 * Steps performed:
 * 1. Converts the mouse's Y-coordinate into the chart’s inverted coordinate system.
 * 2. Translates that pixel position into a price value using the `pixels_per_price_unit` ratio.
 * 3. Adjusts for the chart’s vertical offset (`current_Y_OffSet`).
 * 4. Multiplies by `unit_amount` to get the actual price.
 * 5. Renders the price value at the mouse’s Y position on the price canvas.
 *
 * @example
 * // Example usage inside a render loop:
 * draw_mouse_price(candleChartRef, ctx_price);
 */
export const draw_mouse_price = (candleChartRef, ctx_price) => {

    ctx_price.beginPath();
    ctx_price.fillStyle = "rgb(74, 13, 13)";

    // Flip Mouse Y-Coordinate (convert canvas coordinate to chart coordinate)
    const flipped_y_coord = Math.abs(
        candleChartRef.current.mouse.pos.y - candleChartRef.current.height.currentBaselineY
    );

    // Convert flipped Y-Coordinate into a chart price coordinate
    const y_loc_price = flipped_y_coord / candleChartRef.current.price.current_pixels_per_price_unit;

    // Compute the actual price
    const price = y_loc_price * candleChartRef.current.unit_amount;

    // Draw the price value near the mouse cursor
    ctx_price.fillStyle = "gray";
    ctx_price.font = "20px Source Sans Pro";
    ctx_price.fillText(price.toFixed(2), 20, candleChartRef.current.mouse.pos.y + 5);
    ctx_price.stroke();
};

/**
 * Updates zoom-related and pixel-related values when zooming out on the chart.
 *
 * This function adjusts the following:
 * 1. Increments the chart's current zoom level.
 * 2. Decreases the number of pixels per price unit to reflect zooming out.
 * 3. Updates the baseline Y-coordinates to account for the new zoom.
 * 4. Adjusts the `current_price_unit_pixel_size` to match the new pixel-per-price ratio.
 *
 * @param {Object} candleChartRef - A React ref object containing all current chart state and geometry info.
 * @param {Object} candleChartRef.current.zoom - Object containing zoom-related values.
 * @param {number} candleChartRef.current.zoom.current - The current zoom level.
 * @param {Object} candleChartRef.current.price - Object containing price-related values.
 * @param {number} candleChartRef.current.price.current_pixels_per_price_unit - Pixels per price unit, adjusted here.
 * @param {number} candleChartRef.current.price.current_mid_price - The mid-price used to adjust baseline Y.
 * @param {Object} candleChartRef.current.height - Object containing baseline and chart height info.
 * @param {number} candleChartRef.current.height.currentBaselineY - The current baseline Y-coordinate for the chart.
 * @param {number} candleChartRef.current.height.previousBaselineY - Previous baseline Y, also adjusted.
 *
 * @returns {void}
 *
 * @example
 * // Update chart zoom and pixel info when zooming out
 * update_zoom_out_info(candleChartRef);
 */
export const update_zoom_out_info = (candleChartRef) => {
    candleChartRef.current.zoom.current += 1;
    candleChartRef.current.price.current_pixels_per_price_unit -= 1;
    candleChartRef.current.height.currentBaselineY -= candleChartRef.current.price.current_mid_price;
    candleChartRef.current.height.previousBaselineY -= candleChartRef.current.price.current_mid_price;
    candleChartRef.current.price.current_price_unit_pixel_size =
        Math.floor(candleChartRef.current.price.current_price_unit_pixel_size - 1);
};



/**
 * Calculates the adjusted pixel height for the top of a candle after shrink/expand.
 *
 * This function converts the candle's close-to-open range into canvas pixels,
 * taking into account the current unit amount and pixels-per-price-unit scaling.
 *
 * @param {Object} obj - A candle object containing price data.
 * @param {number} obj.open - The open price of the candle.
 * @param {number} obj.close - The close price of the candle.
 * @param {Object} candleChartRef - React ref containing chart state and scaling info.
 * @param {number} candleChartRef.current.unit_amount - The unit multiplier for scaling prices.
 * @param {number} candleChartRef.current.price.current_pixels_per_price_unit - Pixels per price unit.
 *
 * @returns {number} The truncated pixel value for the top of the candle (negative because canvas y-axis is inverted).
 */
const add_shrink_expand_to_candle_top = (obj, candleChartRef) => {
    let res = (obj.close - obj.open) / candleChartRef.current.unit_amount;
    res = res * candleChartRef.current.price.current_pixels_per_price_unit;
    return Math.trunc(-res);
};

/**
 * Calculates the adjusted pixel position for any candle price after shrink/expand.
 *
 * This function converts a price into canvas pixels and applies baseline and zoom adjustments.
 *
 * @param {number} price - The candle price (high, low, or open).
 * @param {Object} candleChartRef - React ref containing chart state and scaling info.
 * @param {number} candleChartRef.current.unit_amount - The unit multiplier for scaling prices.
 * @param {number} candleChartRef.current.price.current_pixels_per_price_unit - Pixels per price unit.
 * @param {number} candleChartRef.current.height.startingBaselineY - Base Y coordinate for the chart.
 * @param {number} candleChartRef.current.zoom.shrink_expand_height - Additional height adjustment for zoom/shrink.
 *
 * @returns {number} The truncated pixel position for the candle price (negative because canvas y-axis is inverted).
 */
const add_shrink_expand_to_candle = (price, candleChartRef) => {
    let res = price / candleChartRef.current.unit_amount;
    res = res * candleChartRef.current.price.current_pixels_per_price_unit;
    res = res - candleChartRef.current.height.startingBaselineY;
    res = res + candleChartRef.current.zoom.shrink_expand_height;

    return Math.trunc(-res);
};

/**
 * Updates all candle objects with their current pixel positions and heights.
 *
 * This function recalculates each candle's high, low, bottom, and height values
 * based on the current chart scaling and zoom/shrink adjustments.
 *
 * @param {Object} candleChartRef - React ref containing chart state and scaling info.
 * @param {Array&lt;Object>} candleChartRef.current.candles.candles - Array of candle objects with price info.
 *
 * @returns {void} Updates the candle objects in place.
 */
const updateCandles = (candleChartRef) => {
    candleChartRef.current.candles.candles = candleChartRef.current.candles.candles.map((obj) => ({
        ...obj,
        current_high: add_shrink_expand_to_candle(obj.high, candleChartRef),
        current_height:
            Math.abs(obj.current_height) > 1
                ? add_shrink_expand_to_candle_top(obj, candleChartRef)
                : 1,
        current_bottom: add_shrink_expand_to_candle(obj.open, candleChartRef),
        current_low: add_shrink_expand_to_candle(obj.low, candleChartRef),
    }));
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#add_shrink_expand_to_candle">add_shrink_expand_to_candle</a></li><li><a href="global.html#add_shrink_expand_to_candle_top">add_shrink_expand_to_candle_top</a></li><li><a href="global.html#draw_mouse_price">draw_mouse_price</a></li><li><a href="global.html#updateCandles">updateCandles</a></li><li><a href="global.html#update_zoom_out_info">update_zoom_out_info</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Tue Oct 07 2025 22:18:50 GMT-0500 (Central Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
